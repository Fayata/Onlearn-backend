<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Kursus | OnLearn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: { extend: { colors: { primary: '#2563eb', sidebar: '#1e293b', 'sidebar-hover': '#334155' } } }
        }
    </script>
</head>
<body class="bg-gray-50">
    
    {{template "sidebar.html" .}}
    {{template "header.html" .}}

    <div style="margin-left: 250px;" id="mainContent" class="transition-all duration-300">
        <div style="margin-top: 80px;" class="p-8">
            <div class="bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-8 text-white mb-8 shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold mb-2">Jelajahi Katalog Kursus</h2>
                        <p class="text-emerald-100 max-w-2xl">Temukan materi pembelajaran baru untuk meningkatkan karir dan keahlian Anda. Filter berdasarkan kategori untuk menemukan yang paling relevan.</p>
                    </div>
                    <div class="hidden md:block text-6xl opacity-20">
                        <i class="fas fa-search-location"></i>
                    </div>
                </div>
            </div>

            <div class="mb-8 flex items-center gap-4">
                <div class="flex-1 relative">
                    <input type="text" id="searchInput" placeholder="Cari kursus..." class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-lg"></i>
                </div>
                <!-- <select class="px-6 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500">
                    <option>Semua Kategori</option>
                    <option>Backend Development</option>
                    <option>Frontend Development</option>
                    <option>Cyber Security</option>
                </select> -->
                <button class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors">
                    <i class="fas fa-filter mr-2"></i> Filter
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {{range $index, $course := .Courses}}
                {{ $idx := mod $index 6 }}
                {{ $bgGradient := "from-indigo-500 to-purple-600" }}
                {{ $badgeText := "text-indigo-700" }}
                {{ $badgeLabel := "Advanced" }}
                {{ $btnBorder := "border-indigo-600 text-indigo-600 hover:bg-indigo-50" }}
                {{ $btnSolid := "bg-indigo-600 hover:bg-indigo-700" }}

                {{ if eq $idx 1 }}
                    {{ $bgGradient = "from-emerald-500 to-teal-600" }}
                    {{ $badgeText = "text-emerald-700" }}
                    {{ $badgeLabel = "Intermediate" }}
                    {{ $btnBorder = "border-emerald-600 text-emerald-600 hover:bg-emerald-50" }}
                    {{ $btnSolid = "bg-emerald-600 hover:bg-emerald-700" }}
                {{ else if eq $idx 2 }}
                    {{ $bgGradient = "from-rose-500 to-pink-600" }}
                    {{ $badgeText = "text-rose-700" }}
                    {{ $badgeLabel = "Beginner" }}
                    {{ $btnBorder = "border-rose-600 text-rose-600 hover:bg-rose-50" }}
                    {{ $btnSolid = "bg-rose-600 hover:bg-rose-700" }}
                {{ end }}

                <div class="bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all overflow-hidden group cursor-pointer flex flex-col h-full">
                    <div class="h-48 bg-gradient-to-br {{$bgGradient}} relative overflow-hidden flex-shrink-0">
                        <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-all"></div>
                        <div class="absolute top-4 left-4">
                            <span class="px-3 py-1 bg-white/90 backdrop-blur-sm {{$badgeText}} text-xs font-bold rounded-full">{{$badgeLabel}}</span>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 p-6">
                            <h3 class="text-white font-bold text-2xl line-clamp-2">{{.Title}}</h3>
                        </div>
                    </div>
                    <div class="p-6 flex flex-col flex-1">
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3 flex-1">{{.Description}}</p>
                        <div class="flex items-center gap-2 text-sm text-gray-500 mb-4">
                            <i class="fas fa-user text-gray-400"></i>
                            <span>Instructor {{.InstructorID}}</span> 
                        </div>
                        <div class="flex items-center gap-4 text-sm text-gray-500 mb-6">
                            <div class="flex items-center gap-1"><i class="fas fa-book-open text-gray-400"></i> <span>20 modul</span></div>
                            <div class="flex items-center gap-1"><i class="fas fa-users text-gray-400"></i> <span>100+ students</span></div>
                        </div>
                        <div class="flex gap-3 mt-auto">
                            <button onclick="viewCourseDetail({{.ID}})" class="flex-1 px-4 py-2.5 border-2 {{$btnBorder}} rounded-lg font-semibold transition-colors">Detail</button>
                            <button onclick="enrollCourse({{.ID}})" class="flex-1 px-4 py-2.5 {{$btnSolid}} text-white rounded-lg font-semibold transition-colors">Enroll</button>
                        </div>
                    </div>
                </div>
                {{else}}
                <div class="col-span-3 text-center py-12">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mb-4"><i class="fas fa-search text-gray-400 text-3xl"></i></div>
                    <h3 class="text-xl font-semibold text-gray-800">Belum ada kursus tersedia</h3>
                    <p class="text-gray-500 mt-2">Silakan cek kembali nanti untuk kursus terbaru.</p>
                </div>
                {{end}}
            </div>
        </div>
    </div>
    <script>
        let sidebarCollapsed = false;
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const navTexts = document.querySelectorAll('.nav-text');
            const brandText = document.getElementById('brandText');
            sidebarCollapsed = !sidebarCollapsed;
            if (sidebarCollapsed) {
                sidebar.style.width = '80px';
                mainContent.style.marginLeft = '80px';
                if(navTexts) navTexts.forEach(text => text.style.display = 'none');
                if(brandText) brandText.style.display = 'none';
            } else {
                sidebar.style.width = '250px';
                mainContent.style.marginLeft = '250px';
                if(navTexts) navTexts.forEach(text => text.style.display = 'inline');
                if(brandText) brandText.style.display = 'inline';
            }
        }
        function viewCourseDetail(courseId) { window.location.href = `/student/courses/${courseId}`; }
        
        function enrollCourse(courseId) {
            NotificationDialog.confirm(
                'Apakah Anda yakin ingin mendaftar di kursus ini?',
                async () => {
                    try {
                        const response = await fetch(`/api/v1/student/courses/${courseId}/enroll`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });

                        if (response.ok) {
                            NotificationDialog.alert('Anda berhasil mendaftar kursus!', 'Sukses');
                            // Redirect after a short delay to allow user to read the message
                            setTimeout(() => {
                                window.location.href = '/student/courses';
                            }, 1500);
                        } else {
                            const error = await response.json();
                            NotificationDialog.alert('Gagal mendaftar: ' + (error.error || 'Terjadi kesalahan'), 'Gagal');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        NotificationDialog.alert('Terjadi kesalahan koneksi.', 'Error');
                    }
                },
                'Konfirmasi Pendaftaran'
            );
        }
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.grid > div');
            cards.forEach(card => {
                const title = card.querySelector('h3') ? card.querySelector('h3').innerText.toLowerCase() : '';
                if (title.includes(searchTerm)) card.style.display = 'flex'; else card.style.display = 'none';
            });
        });
    </script>
</body>
</html>